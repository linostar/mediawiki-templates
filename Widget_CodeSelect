<style>
  .codeBoxArea {
    border: 1px rgb(140, 140, 140) solid;
    background-color: rgb(180, 180, 180);
    width: 99%;
    height: auto;
    overflow: auto;
    resize: none;
    cursor: text !important; 
  }
  .selectLink {
    float: right;
  }
  .preDiv {
    display: block;
  }
  .textareaDiv {
    display: none;
  }
</style>

<div>
<div class="selectBtnDiv"></div>
<div class="preDiv">
<pre><!--{$code|escape:'html'}--></pre>
</div>
<div class="textareaDiv">
<textarea class="codeBoxArea" rows="1" readonly="readonly"><!--{$code|escape:'html'}--></textarea>
</div>
</div>

<script>
  function SelectText(element) {
    element.focus();
    element.setSelectionRange(0, element.value.length);
  }

  function adjustHeight(element) {
    element.style.height = "auto";
    element.style.height = (element.scrollHeight-6) + "px";
  }

  var btnDivs = document.getElementsByClassName("selectBtnDiv");
  for (var i=0; i<btnDivs.length; i++) {
    btnDivs[i].parentNode.children[1].style.display = "none";
    btnDivs[i].parentNode.children[2].style.display = "block";
    btnDivs[i].innerHTML = "<font size='-2'><a href='#' class='selectLink' onclick='SelectText(this.parentNode.parentNode.parentNode.children[2].children[0]); return false;'>[select code]</a></font>";
    adjustHeight(btnDivs[i].parentNode.children[2].children[0]);
}
</script>

